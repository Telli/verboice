= form_for [project, scheduled_call], :remote => true do |f|
  .toptitle
    %span Name
  .middle
    = f.text_field :name, :class => 'w30'
    %p
      = f.label :enabled do
        = f.check_box :enabled
        Enabled
    %p Call flow
    = f.collection_select :call_flow_id, call_flows, :id, :name, {prompt: 'Select a Call flow...'}, {class: 'w30'}
    %p Channel
    = f.collection_select :channel_id, channels, :id, :name, {prompt: 'Select a Channel...'}, {class: 'w30'}
    %p Schedule
    = f.select_recurring :recurrence_rule, [scheduled_call.recurrence_rule], {allow_blank: false}
    .time-range
      = f.hidden_field :from_time, class: 'from'
      = f.hidden_field :to_time, class: 'to'

    .date-time
      %p
        = f.label :not_before_enabled do
          = f.check_box :not_before_enabled, :class => 'date-time-trigger'
          Not before enabled
      = f.text_field :not_before_date, :class => "datepicker w10", :id => nil
      = f.text_field :not_before_time, :class => 'w10 not_before_time', :alt => 'time'
    .date-time
      %p
        = f.label :not_after_enabled do
          = f.check_box :not_after_enabled, :class => 'date-time-trigger'
          Not after enabled
      = f.text_field :not_after_date, :class => "datepicker w10", :id => nil
      = f.text_field :not_after_time, :class => 'w10 not_after_time', :alt => 'time'

    %p Time zone
    = f.time_zone_select :time_zone, nil, default: project.time_zone

    %p Filters
    = f.hidden_field :filters_json, 'data-bind' => 'value: json', 'class' => 'filters'
    %ul{'data-bind' => 'foreach: filters'}
      %li
        /ko if: expanded()
        %select{'data-bind' => "options: window.variables, optionsText: 'name', value: variable"}
        %select{'data-bind' => "options: operators, optionsText: 'text', value: operator"}
        / ko ifnot: unary()
        %select{'data-bind' => "options: other_types, value: other_type"}
        / ko if: other_type() == 'value'
        %input{'type' => 'text', 'data-bind' => 'value: value'}
        / /ko
        / ko if: other_type() == 'variable'
        %select{'data-bind' => "options: window.variables, optionsText: 'name', value: other_variable"}
        / /ko
        / /ko
        %button.faccept{'data-bind' => 'click: close'}
        / /ko
        /ko ifnot: expanded()
        %p{'data-bind' => 'text: description, click: expand'}
        %button.fclose{'data-bind' => 'click: $parent.removeFilter'}
        / /ko
    %button.fadd{'data-bind' => 'click: addFilter'} Add filter
  %hr
  - if scheduled_call.new_record?
    %button.white{:type => "submit"} Save
  - else
    %button.white{:type => "submit"} Update
  = link_to 'Cancel', '#', :class => "tgrey #{scheduled_call.new_record? ? 'remove_unsaved_element' : 'collapse_trigger'}", :style => 'top: 1px;'
