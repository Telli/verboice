%script{type: "text/html", id: "workflow_step_template"}
  /ko if: type() != 'skip'
  %div{ ko(:class => "index() ? 'b' : ''") }
    %span
      %p{ ko(:css => "{'alert-icon': is_invalid()}")}
      %p.button{ ko(:click => "set_as_current", :class => "button_class", :css => "{active: $data == $root.current_step(), alert: is_invalid()}", :style => "{'background': background_style()}") }
      %a.insertBefore{ ko(:click => "insert_before", :visible => "$data == $root.current_step() && can_insert_before()"), :title => "Insert new step before" }
      %a.insertAfter{ ko(:click => "insert_after", :visible => "$data == $root.current_step() && can_insert_after()"), :title => "Insert new step after" }
      %br/
      %p{ ko(text: 'name', :css => "{alert: is_invalid()}") }
      %p{ ko(text: 'index') }

    .sub{ko(template: "{name: 'workflow_step_template', foreach: children()}")}

    / ko if: has_next()
    / ko template: {name: 'workflow_step_template', data: next()}
    / /ko
    / /ko

  /ko if: root
  %br/
  / /ko

  / /ko